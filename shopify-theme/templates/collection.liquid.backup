{% comment %}
  Collection template - Elegant minimalist design
{% endcomment %}

<main class="collection-page">
  <!-- Collection Header -->
  <div class="collection-header">
    <h1 class="collection-title">
      {{ collection.title }}
    </h1>
  </div>

  <!-- Filters and Toolbar Row -->
  <div class="collection-toolbar-row">
    <!-- Filters (Left) -->
    {%- if collection.filters.size > 0 -%}
      {%- comment -%} Check if any filters are active {%- endcomment -%}
      {%- assign has_active_filters = false -%}
      {%- for filter in collection.filters -%}
        {%- if filter.type == 'list' -%}
          {%- for filter_value in filter.values -%}
            {%- if filter_value.active -%}
              {%- assign has_active_filters = true -%}
              {%- break -%}
            {%- endif -%}
          {%- endfor -%}
        {%- elsif filter.type == 'price_range' -%}
          {%- if filter.min_value.value > 0 or filter.max_value.value < filter.range_max -%}
            {%- assign has_active_filters = true -%}
          {%- endif -%}
        {%- endif -%}
        {%- if has_active_filters -%}
          {%- break -%}
        {%- endif -%}
      {%- endfor -%}

      <div class="collection-filters-row">
        <form id="collection-filters" method="get" action="{{ collection.url }}" class="filters-form">
          {%- for filter in collection.filters -%}
            <div class="filter-group-horizontal">
              <button type="button" class="filter-trigger-horizontal" data-filter-type="{{ filter.type }}">
                <span>{{ filter.label }}</span>
                <svg class="filter-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div class="filter-dropdown" data-filter-type="{{ filter.type }}">
                {%- case filter.type -%}
                  {%- when 'list' -%}
                    {%- for filter_value in filter.values -%}
                      <label class="filter-option">
                        <input
                          type="checkbox"
                          name="{{ filter_value.param_name }}"
                          value="{{ filter_value.value }}"
                          {% if filter_value.active %}checked{% endif %}
                          onchange="this.form.submit()"
                        >
                        <span>{{ filter_value.label }}</span>
                      </label>
                    {%- endfor -%}
                  {%- when 'price_range' -%}
                    <div class="filter-price-range">
                      <input
                        type="range"
                        name="{{ filter.min_value.param_name }}"
                        min="0"
                        max="{{ filter.range_max | money_without_currency | remove: ',' }}"
                        value="{{ filter.min_value.value | money_without_currency | remove: ',' }}"
                      >
                      <input
                        type="range"
                        name="{{ filter.max_value.param_name }}"
                        min="0"
                        max="{{ filter.range_max | money_without_currency | remove: ',' }}"
                        value="{{ filter.max_value.value | money_without_currency | remove: ',' }}"
                      >
                    </div>
                {%- endcase -%}
              </div>
            </div>
          {%- endfor -%}

          {%- if has_active_filters -%}
            <a href="{{ collection.url }}" class="filter-clear-horizontal">
              Clear all
            </a>
          {%- endif -%}
        </form>
      </div>
    {%- endif -%}

    <!-- Toolbar: Items count and Sort (Right) -->
    <div class="collection-toolbar">
      <span class="collection-count">
        {{ collection.products_count }} {{ collection.products_count | pluralize: 'item', 'items' }}
      </span>
      <div class="collection-sort">
        <form method="get" action="{{ collection.url }}" class="sort-form" id="sort-form">
          <input type="hidden" name="sort_by" id="sort-by" value="{{ collection.sort_by | default: 'manual' }}">
          <div class="sort-group-horizontal">
            <button type="button" class="sort-trigger-horizontal">
              <span class="sort-selected-text">
                {%- case collection.sort_by -%}
                  {%- when 'manual' -%}Featured
                  {%- when 'best-selling' -%}Best selling
                  {%- when 'title-ascending' -%}Alphabetically, A-Z
                  {%- when 'title-descending' -%}Alphabetically, Z-A
                  {%- when 'price-ascending' -%}Price, low to high
                  {%- when 'price-descending' -%}Price, high to low
                  {%- when 'created-ascending' -%}Date, old to new
                  {%- when 'created-descending' -%}Date, new to old
                  {%- else -%}Featured
                {%- endcase -%}
              </span>
              <svg class="sort-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div class="sort-dropdown">
              <button type="button" class="sort-option {% if collection.sort_by == 'manual' or collection.sort_by == blank %}sort-option-active{% endif %}" data-value="manual">Featured</button>
              <button type="button" class="sort-option {% if collection.sort_by == 'best-selling' %}sort-option-active{% endif %}" data-value="best-selling">Best selling</button>
              <button type="button" class="sort-option {% if collection.sort_by == 'title-ascending' %}sort-option-active{% endif %}" data-value="title-ascending">Alphabetically, A-Z</button>
              <button type="button" class="sort-option {% if collection.sort_by == 'title-descending' %}sort-option-active{% endif %}" data-value="title-descending">Alphabetically, Z-A</button>
              <button type="button" class="sort-option {% if collection.sort_by == 'price-ascending' %}sort-option-active{% endif %}" data-value="price-ascending">Price, low to high</button>
              <button type="button" class="sort-option {% if collection.sort_by == 'price-descending' %}sort-option-active{% endif %}" data-value="price-descending">Price, high to low</button>
              <button type="button" class="sort-option {% if collection.sort_by == 'created-ascending' %}sort-option-active{% endif %}" data-value="created-ascending">Date, old to new</button>
              <button type="button" class="sort-option {% if collection.sort_by == 'created-descending' %}sort-option-active{% endif %}" data-value="created-descending">Date, new to old</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Products Section -->
  <div class="collection-container">
    <div class="collection-products">

      <!-- Products Grid -->
      {%- if collection.products_count > 0 -%}
        <div class="products-grid">
          {%- for product in collection.products -%}
            <div class="collection-product-card" data-product-id="{{ product.id }}">
              <a href="{{ product.url }}" class="product-link">
                <div class="product-image-wrapper">
                  {%- if product.images.size > 0 -%}
                    {%- for image in product.images -%}
                      <img
                        src="{{ image | image_url: width: 600 }}"
                        srcset="{{ image | image_url: width: 400 }} 400w,
                                {{ image | image_url: width: 600 }} 600w,
                                {{ image | image_url: width: 800 }} 800w"
                        sizes="(max-width: 768px) 50vw, (max-width: 1024px) 33vw, 25vw"
                        alt="{{ image.alt | escape | default: product.title }}"
                        class="product-image {% if forloop.first %}product-image-active{% else %}product-image-hidden{% endif %}"
                        data-image-index="{{ forloop.index0 }}"
                        loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                      >
                    {%- endfor -%}
                    {%- if product.images.size > 1 -%}
                      <button type="button" class="product-carousel-arrow product-carousel-prev" aria-label="Previous image">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                      </button>
                      <button type="button" class="product-carousel-arrow product-carousel-next" aria-label="Next image">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                      </button>
                    {%- endif -%}
                  {%- else -%}
                    <div class="product-image-placeholder">
                      <span>No image</span>
                    </div>
                  {%- endif -%}
                  {%- unless product.available -%}
                    <div class="product-sold-out">Sold out</div>
                  {%- endunless -%}
                </div>
                <div class="product-info">
                  <h3 class="product-name">{{ product.title }}</h3>
                  <p class="product-price">
                    {{ product.price | money }}
                    {%- if product.compare_at_price > product.price -%}
                      <span class="product-price-compare">{{ product.compare_at_price | money }}</span>
                    {%- endif -%}
                  </p>
                </div>
              </a>
            </div>
          {%- endfor -%}
        </div>
      {%- else -%}
        <div class="collection-empty">
          <p>No products found in this collection.</p>
        </div>
      {%- endif -%}
    </div>
  </div>
</main>

<style>
  /* Collection Page - Full Width Layout */
  .collection-page {
    width: 100%;
    padding: 0;
    margin: 0;
  }

  /* Collection Header */
  .collection-header {
    width: 100%;
    padding: 2rem 1.5rem 0.5rem;
  }

  .collection-title {
    font-size: 2rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: hsl(var(--foreground));
    margin: 0;
  }

  /* Toolbar Row - Filters and Sort on same line */
  .collection-toolbar-row {
    width: 100%;
    padding: 0.5rem 1.5rem 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
  }

  /* Filters Row - Horizontal */
  .collection-filters-row {
    display: flex;
    align-items: center;
    flex: 1;
  }

  .filters-form {
    display: flex;
    align-items: center;
    gap: 2rem;
    flex-wrap: wrap;
  }

  .filter-group-horizontal {
    position: relative;
  }

  .filter-trigger-horizontal {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: hsl(var(--foreground));
    transition: color 0.2s ease;
    white-space: nowrap;
  }

  .filter-trigger-horizontal:hover {
    color: hsl(var(--muted-foreground));
  }

  .filter-icon {
    width: 0.875rem;
    height: 0.875rem;
    transition: transform 0.2s ease;
  }

  .filter-group-horizontal[data-open="true"] .filter-icon {
    transform: rotate(180deg);
  }

  .filter-dropdown {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    margin-top: 0.5rem;
    padding: 1rem;
    background: hsl(var(--background));
    border: 1px solid hsl(var(--border));
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    z-index: 100;
    min-width: 200px;
    max-height: 400px;
    overflow-y: auto;
  }

  .filter-group-horizontal[data-open="true"] .filter-dropdown {
    display: block;
  }

  .filter-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0;
    cursor: pointer;
    font-size: 0.875rem;
    color: hsl(var(--foreground));
  }

  .filter-option input[type="checkbox"] {
    width: 1rem;
    height: 1rem;
    cursor: pointer;
    accent-color: hsl(var(--foreground));
  }

  .filter-price-range {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .filter-clear-horizontal {
    font-size: 0.875rem;
    text-decoration: underline;
    color: hsl(var(--muted-foreground));
    transition: color 0.2s ease;
    white-space: nowrap;
  }

  .filter-clear-horizontal:hover {
    color: hsl(var(--foreground));
  }

  /* Collection Container */
  .collection-container {
    width: 100%;
    padding: 0 1.5rem 2rem;
    max-width: 100%;
  }

  /* Products Section */
  .collection-products {
    width: 100%;
    min-width: 0;
  }

  /* Toolbar - Right side */
  .collection-toolbar {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 2rem;
    flex-shrink: 0;
  }

  .collection-count {
    font-size: 0.875rem;
    color: hsl(var(--muted-foreground));
  }

  .collection-sort {
    display: flex;
    align-items: center;
  }

  .sort-group-horizontal {
    position: relative;
  }

  .sort-trigger-horizontal {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: hsl(var(--foreground));
    transition: color 0.2s ease;
    white-space: nowrap;
  }

  .sort-trigger-horizontal:hover {
    color: hsl(var(--muted-foreground));
  }

  .sort-icon {
    width: 0.875rem;
    height: 0.875rem;
    transition: transform 0.2s ease;
  }

  .sort-group-horizontal[data-open="true"] .sort-icon {
    transform: rotate(180deg);
  }

  .sort-dropdown {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    padding: 1rem;
    background: hsl(var(--background));
    border: 1px solid hsl(var(--border));
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    z-index: 100;
    min-width: 200px;
    max-height: 400px;
    overflow-y: auto;
  }

  .sort-group-horizontal[data-open="true"] .sort-dropdown {
    display: block;
  }

  .sort-option {
    display: block;
    width: 100%;
    padding: 0.5rem 0;
    background: none;
    border: none;
    text-align: left;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 400;
    color: hsl(var(--foreground));
    transition: color 0.2s ease;
  }

  .sort-option:hover {
    color: hsl(var(--muted-foreground));
  }

  .sort-option-active {
    font-weight: 500;
  }

  /* Products Grid - Bigger images like featured collection */
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
    gap: 3rem 2rem;
    width: 100%;
  }

  /* Product Card */
  .collection-product-card {
    width: 100%;
  }

  .product-link {
    display: block;
    text-decoration: none !important;
    color: inherit;
  }

  .product-link:hover {
    text-decoration: none !important;
  }

  .product-link:hover .product-name,
  .product-link:hover .product-price {
    text-decoration: none !important;
  }

  .product-image-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 150%; /* 2:3 aspect ratio (portrait) */
    overflow: hidden;
    background: hsl(var(--secondary));
    margin-bottom: 1rem;
  }

  .product-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center;
    transition: opacity 0.3s ease;
  }

  .product-image-active {
    opacity: 1;
    z-index: 1;
  }

  .product-image-hidden {
    opacity: 0;
    z-index: 0;
    pointer-events: none;
  }

  .product-image-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: hsl(var(--muted-foreground));
    font-size: 0.875rem;
  }

  /* Carousel Arrows */
  .product-carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid hsl(var(--border));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.3s ease, background-color 0.2s ease;
    z-index: 10;
    pointer-events: none;
  }

  .collection-product-card:hover .product-carousel-arrow {
    opacity: 1;
    pointer-events: auto;
  }

  .product-carousel-arrow:hover {
    background: rgba(255, 255, 255, 1);
  }

  .product-carousel-prev {
    left: 10px;
  }

  .product-carousel-next {
    right: 10px;
  }

  .product-carousel-arrow svg {
    width: 20px;
    height: 20px;
    color: hsl(var(--foreground));
  }

  .product-sold-out {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    padding: 0.25rem 0.75rem;
    background: transparent;
    color: hsl(var(--foreground));
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    z-index: 20;
  }

  .product-info {
    text-align: left;
  }

  .product-name {
    font-size: 0.875rem;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: hsl(var(--foreground));
    margin: 0 0 0.5rem;
    line-height: 1.4;
    text-decoration: none;
  }

  .product-price {
    font-size: 0.875rem;
    font-weight: 400;
    color: hsl(var(--foreground));
    margin: 0;
    text-decoration: none;
  }

  .product-price-compare {
    text-decoration: line-through;
    color: hsl(var(--muted-foreground));
    margin-left: 0.5rem;
  }

  /* Empty State */
  .collection-empty {
    text-align: center;
    padding: 4rem 2rem;
    color: hsl(var(--muted-foreground));
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .collection-container {
      padding: 0 1rem 2rem;
    }

    .collection-toolbar-row {
      padding: 1.5rem 1rem 0;
    }

    .products-grid {
      grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
      gap: 2rem 1.5rem;
    }
  }

  @media (max-width: 768px) {
    .collection-header {
      padding: 1.5rem 1rem 1rem;
    }

    .collection-toolbar-row {
      flex-direction: column;
      align-items: flex-start;
      gap: 1.5rem;
      padding: 1rem 1rem 0;
    }

    .collection-filters-row {
      width: 100%;
    }

    .filters-form {
      gap: 1rem;
    }

    .collection-toolbar {
      width: 100%;
      justify-content: space-between;
    }

    .collection-container {
      padding: 0 1rem 1.5rem;
    }

    .products-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem 1rem;
      min-width: 0;
    }
    
    .collection-product-card {
      min-width: 0;
    }

    .product-image-wrapper {
      padding-bottom: 150%; /* Maintain 2:3 portrait aspect ratio */
    }
  }
</style>

<script>
  // Filter toggle functionality
  (function() {
    const filterTriggers = document.querySelectorAll('.filter-trigger-horizontal');
    
    filterTriggers.forEach(trigger => {
      trigger.addEventListener('click', function(e) {
        e.stopPropagation();
        const filterGroup = this.closest('.filter-group-horizontal');
        const isOpen = filterGroup.getAttribute('data-open') === 'true';
        
        // Close all other filters
        document.querySelectorAll('.filter-group-horizontal').forEach(group => {
          if (group !== filterGroup) {
            group.setAttribute('data-open', 'false');
          }
        });
        
        // Toggle current filter
        filterGroup.setAttribute('data-open', isOpen ? 'false' : 'true');
      });
    });

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.filter-group-horizontal')) {
        document.querySelectorAll('.filter-group-horizontal').forEach(group => {
          group.setAttribute('data-open', 'false');
        });
      }
    });
  })();

  // Sort dropdown toggle functionality
  (function() {
    const sortTrigger = document.querySelector('.sort-trigger-horizontal');
    const sortGroup = document.querySelector('.sort-group-horizontal');
    const sortOptions = document.querySelectorAll('.sort-option');
    const sortForm = document.getElementById('sort-form');
    const sortInput = document.getElementById('sort-by');
    const sortSelectedText = document.querySelector('.sort-selected-text');
    
    if (sortTrigger && sortGroup) {
      sortTrigger.addEventListener('click', function(e) {
        e.stopPropagation();
        const isOpen = sortGroup.getAttribute('data-open') === 'true';
        
        // Close all filters
        document.querySelectorAll('.filter-group-horizontal').forEach(group => {
          group.setAttribute('data-open', 'false');
        });
        
        // Toggle sort dropdown
        sortGroup.setAttribute('data-open', isOpen ? 'false' : 'true');
      });
      
      // Handle sort option selection
      sortOptions.forEach(option => {
        option.addEventListener('click', function(e) {
          e.stopPropagation();
          const value = this.getAttribute('data-value');
          const text = this.textContent.trim();
          
          // Update hidden input
          sortInput.value = value;
          
          // Update displayed text
          sortSelectedText.textContent = text;
          
          // Update active state
          sortOptions.forEach(opt => opt.classList.remove('sort-option-active'));
          this.classList.add('sort-option-active');
          
          // Close dropdown
          sortGroup.setAttribute('data-open', 'false');
          
          // Submit form
          sortForm.submit();
        });
      });
      
      // Close sort dropdown when clicking outside
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.sort-group-horizontal')) {
          sortGroup.setAttribute('data-open', 'false');
        }
      });
    }
  })();

  // Product Image Carousel
  (function() {
    const productCards = document.querySelectorAll('.collection-product-card');
    
    productCards.forEach(card => {
      const images = card.querySelectorAll('.product-image');
      const prevBtn = card.querySelector('.product-carousel-prev');
      const nextBtn = card.querySelector('.product-carousel-next');
      
      if (images.length <= 1 || !prevBtn || !nextBtn) return;
      
      let currentIndex = 0;
      
      function showImage(index) {
        images.forEach((img, i) => {
          if (i === index) {
            img.classList.remove('product-image-hidden');
            img.classList.add('product-image-active');
          } else {
            img.classList.remove('product-image-active');
            img.classList.add('product-image-hidden');
          }
        });
        currentIndex = index;
      }
      
      prevBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        const newIndex = currentIndex > 0 ? currentIndex - 1 : images.length - 1;
        showImage(newIndex);
      });
      
      nextBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        const newIndex = currentIndex < images.length - 1 ? currentIndex + 1 : 0;
        showImage(newIndex);
      });
      
      // Reset to first image when mouse leaves
      card.addEventListener('mouseleave', function() {
        showImage(0);
      });
    });
  })();
</script>
