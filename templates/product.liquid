{% comment %}
  The product template
{% endcomment %}

<main class="product-page">
  <div class="product-layout">
    <!-- Product Images -->
    <div class="product-gallery">
      {%- if product.images.size > 0 -%}
        <!-- Mobile gallery: main image + thumbnail carousel -->
        <div class="product-gallery-mobile">
          {%- assign first_image = product.images.first -%}
          <div class="product-main-image aspect-[3/4] overflow-hidden">
            <img
              src="{{ first_image | image_url: width: 900 }}"
              alt="{{ first_image.alt | escape }}"
              class="w-full h-full object-cover"
              loading="lazy"
              width="{{ first_image.width }}"
              height="{{ first_image.height }}"
              data-main-image
            >
          </div>
          <div class="product-thumbnails" aria-label="Product images">
            {%- for image in product.images -%}
              <button
                type="button"
                class="product-thumb{% if forloop.first %} is-active{% endif %}"
                data-image-src="{{ image | image_url: width: 900 }}"
                data-image-alt="{{ image.alt | escape }}"
                aria-label="{{ image.alt | default: product.title | escape }}"
              >
                <div class="product-thumb-inner">
                  <img
                    src="{{ image | image_url: width: 240 }}"
                    alt="{{ image.alt | escape }}"
                    class="w-full h-full object-cover"
                    loading="lazy"
                    width="{{ image.width }}"
                    height="{{ image.height }}"
                  >
                </div>
              </button>
            {%- endfor -%}
          </div>
        </div>

        <!-- Desktop gallery: stacked images -->
        <div class="product-gallery-desktop">
          {%- for image in product.images -%}
            <div class="product-media aspect-[3/4] overflow-hidden">
              <img
                src="{{ image | image_url: width: 800 }}"
                alt="{{ image.alt | escape }}"
                class="w-full h-full object-cover"
                loading="lazy"
                width="{{ image.width }}"
                height="{{ image.height }}"
              >
            </div>
          {%- endfor -%}
        </div>
      {%- else -%}
        <div class="aspect-[3/4] overflow-hidden bg-secondary">
          {{ 'product-1.jpg' | asset_url | image_tag: loading: 'lazy', class: 'w-full h-full object-cover' }}
        </div>
      {%- endif -%}
    </div>

    <!-- Product Info -->
    <div class="product-details-column">
      <div class="product-details">
      <!-- Title & price -->
      <h1 class="product-title font-serif text-3xl md:text-4xl mb-2">{{ product.title }}</h1>
      <p class="product-price-main text-2xl mb-6">
        {{ product.price | money }}
        {%- if product.compare_at_price > product.price -%}
          <span class="line-through text-muted-foreground ml-2">{{ product.compare_at_price | money }}</span>
        {%- endif -%}
      </p>

      <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data" id="product-form">
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" id="product-variant-id">

        <!-- Size / options row with size guide link -->
        {%- unless product.has_only_default_variant -%}
          {%- for option in product.options_with_values -%}
            <div class="mb-6">
              <div class="flex items-center justify-between mb-3">
                <p class="font-medium">{{ option.name }}</p>
                {%- if option.name == 'Taille' or option.name == 'Size' -%}
                  {%- if product.metafields.custom.size_guide_url != blank -%}
                    <a href="{{ product.metafields.custom.size_guide_url }}" class="text-xs tracking-wide underline text-muted-foreground hover:text-foreground" target="_blank" rel="noopener">
                      {{ 'products.product.size_guide' | t: default: 'Guide des tailles' }}
                    </a>
                  {%- endif -%}
                {%- endif -%}
              </div>
              <div class="flex gap-2 flex-wrap">
                {%- for value in option.values -%}
                  <button
                    type="button"
                    class="variant-option pill-option min-w-[3rem] h-10 px-4 text-sm transition-colors {% if option.selected_value == value %}is-selected{% else %}is-unselected{% endif %}"
                    data-option-name="{{ option.name }}"
                    data-option-value="{{ value }}"
                  >
                    {{ value }}
                  </button>
                {%- endfor -%}
              </div>
            </div>
          {%- endfor -%}
        {%- endunless -%}

        <!-- Quantity & Add-to-cart bar -->
        <div class="mb-6">
          <p class="font-medium mb-3">{{ 'products.product.quantity' | t }}</p>
          <div class="flex items-center gap-4">
            <button type="button" class="quantity-decrease cart-btn-quantity w-10 h-10 border border-border flex items-center justify-center">-</button>
            <input type="number" name="quantity" value="1" min="1" class="quantity-input w-12 text-center border-0" id="quantity">
            <button type="button" class="quantity-increase cart-btn-quantity w-10 h-10 border border-border flex items-center justify-center">+</button>
          </div>
        </div>

        <button type="submit" class="btn btn-default w-full h-12 mb-8" id="add-to-cart-button">
          {{ 'products.product.add_to_cart' | t }}
        </button>
      </form>

      <!-- Accordion sections -->
      <div class="product-accordion space-y-1">
        {%- assign has_description = product.description != blank -%}
        {%- assign composition = product.metafields.custom.composition -%}
        {%- assign care = product.metafields.custom.care_instructions -%}
        {%- assign shipping = product.metafields.custom.shipping_info -%}
        {%- assign made_in = product.metafields.custom.made_in -%}

        {%- if has_description -%}
          <details class="product-accordion-item" open>
            <summary class="product-accordion-summary">
              <span class="product-accordion-label">
                <span class="product-accordion-icon">i</span>
                {{ 'products.product.description' | t: default: 'Description' }}
              </span>
              <span class="product-accordion-chevron">&#x25BC;</span>
            </summary>
            <div class="product-accordion-body">
              {{ product.description }}
            </div>
          </details>
        {%- endif -%}

        {%- if composition != blank -%}
          <details class="product-accordion-item">
            <summary class="product-accordion-summary">
              <span class="product-accordion-label">
                <span class="product-accordion-icon">%</span>
                {{ 'products.product.composition' | t: default: 'Composition' }}
              </span>
              <span class="product-accordion-chevron">&#x25BC;</span>
            </summary>
            <div class="product-accordion-body">
              {{ composition }}
            </div>
          </details>
        {%- endif -%}

        {%- if care != blank -%}
          <details class="product-accordion-item">
            <summary class="product-accordion-summary">
              <span class="product-accordion-label">
                <span class="product-accordion-icon">*</span>
                {{ 'products.product.care' | t: default: 'Care instructions' }}
              </span>
              <span class="product-accordion-chevron">&#x25BC;</span>
            </summary>
            <div class="product-accordion-body">
              {{ care }}
            </div>
          </details>
        {%- endif -%}

        {%- if shipping != blank -%}
          <details class="product-accordion-item">
            <summary class="product-accordion-summary">
              <span class="product-accordion-label">
                <span class="product-accordion-icon">&#x2708;</span>
                {{ 'products.product.shipping' | t: default: 'Delivery & returns' }}
              </span>
              <span class="product-accordion-chevron">&#x25BC;</span>
            </summary>
            <div class="product-accordion-body">
              {{ shipping }}
            </div>
          </details>
        {%- endif -%}

        {%- if made_in != blank -%}
          <details class="product-accordion-item">
            <summary class="product-accordion-summary">
              <span class="product-accordion-label">
                <span class="product-accordion-icon">&#x25A0;</span>
                {{ 'products.product.made_in' | t: default: 'Made in' }}
              </span>
              <span class="product-accordion-chevron">&#x25BC;</span>
            </summary>
            <div class="product-accordion-body">
              {{ made_in }}
            </div>
          </details>
        {%- endif -%}
      </div>

      <div class="product-preorder-teaser">
        <p class="product-preorder-teaser-title">HOW DOES PRE-ORDERING WORK?</p>
        <p>
          Learn more about our made-to-order process, timings and how pre-orders help us produce responsibly.
          <a href="/pages/how-pre-orders-work" class="product-preorder-teaser-link">
            Discover the pre-order journey
          </a>
        </p>
      </div>

    </div>
  </div>

  <div id="preorder-modal" class="preorder-modal" aria-hidden="true">
    <div class="preorder-modal-overlay" data-preorder-modal-overlay></div>
    <div class="preorder-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="preorder-modal-title">
      <button type="button" class="preorder-modal-close" data-preorder-modal-close aria-label="Close">
        &times;
      </button>
      <div class="preorder-modal-body">
        {% section 'preorder-info' %}
        <div class="preorder-modal-actions">
          <button type="button" class="btn btn-default w-full" data-preorder-confirm>
            I understand, continue to pre-order
          </button>
        </div>
      </div>
    </div>
  </div>

</main>
