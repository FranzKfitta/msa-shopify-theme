{% liquid
  assign use_placeholders = section.settings.use_placeholders

  assign collection_1 = collections[section.settings.collection_1]
  assign collection_2 = collections[section.settings.collection_2]
  assign collection_3 = collections[section.settings.collection_3]

  assign image_1 = section.settings.image_1
  assign image_2 = section.settings.image_2
  assign image_3 = section.settings.image_3

  assign title_1 = section.settings.title_1
  assign title_2 = section.settings.title_2
  assign title_3 = section.settings.title_3

  assign placeholder_image_1 = section.settings.placeholder_image_1
  assign placeholder_image_2 = section.settings.placeholder_image_2
  assign placeholder_image_3 = section.settings.placeholder_image_3
%}

<section class="py-12 md:py-16">
  <div class="w-full">
    {% if section.settings.heading != blank %}
      <div class="mb-8 sm:mb-10 md:mb-12 px-4 md:px-6">
        <h2 class="font-serif text-2xl sm:text-3xl md:text-4xl font-bold tracking-wide uppercase">
          {{ section.settings.heading }}
        </h2>
      </div>
    {% endif %}

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 px-4 md:px-6">
      {% assign items = 3 %}
      {% for i in (1..items) %}
        {% capture col_handle %}collection_{{ i }}{% endcapture %}
        {% capture img_handle %}image_{{ i }}{% endcapture %}
        {% capture title_handle %}title_{{ i }}{% endcapture %}
        {% capture ph_handle %}placeholder_image_{{ i }}{% endcapture %}

        {% assign block_collection = collections[section.settings[col_handle]] %}
        {% assign block_image = section.settings[img_handle] %}
        {% assign block_title = section.settings[title_handle] %}
        {% assign block_placeholder = section.settings[ph_handle] %}

        {% assign has_collection = false %}
        {% if block_collection and block_collection != blank %}
          {% assign has_collection = true %}
        {% endif %}

        {% if use_placeholders %}
          {% assign display_image = block_placeholder %}
          {% assign display_title = block_title %}
          {% assign display_url = '#' %}
        {% else %}
          {% if block_image != blank %}
            {% assign display_image = block_image %}
          {% elsif has_collection and block_collection.image != blank %}
            {% assign display_image = block_collection.image %}
          {% else %}
            {% assign display_image = block_placeholder %}
          {% endif %}

          {% if has_collection %}
            {% assign display_title = block_title | default: block_collection.title %}
            {% assign display_url = block_collection.url %}
          {% else %}
            {% assign display_title = block_title %}
            {% assign display_url = '#' %}
          {% endif %}
        {% endif %}

        <div class="flex flex-col">
          {% if display_url != '#' %}
            <a href="{{ display_url }}" class="group block">
          {% else %}
            <div class="group block">
          {% endif %}

              <div class="relative w-full overflow-hidden bg-secondary" style="aspect-ratio: 3 / 4;">
                {% if display_image != blank %}
                  <img
                    src="{{ display_image | image_url: width: 900 }}"
                    alt="{{ display_title | default: 'Collection' | escape }}"
                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-[1.02]"
                    loading="lazy"
                  >
                {% else %}
                  {{ 'collection-1' | placeholder_svg_tag: 'w-full h-full object-cover bg-secondary' }}
                {% endif %}
              </div>

              <div class="pt-3 text-center">
                {% if display_title != blank %}
                  <span class="block text-sm sm:text-base font-medium tracking-[0.2em] uppercase">
                    {{ display_title }}
                  </span>
                {% endif %}
              </div>

          {% if display_url != '#' %}
            </a>
          {% else %}
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Collection Row",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop by category"
    },
    {
      "type": "checkbox",
      "id": "use_placeholders",
      "label": "Use placeholder images only",
      "default": false,
      "info": "Enable to use static images/text instead of real collections."
    },
    {
      "type": "header",
      "content": "Collection 1"
    },
    {
      "type": "collection",
      "id": "collection_1",
      "label": "Collection 1"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Custom image 1 (optional)"
    },
    {
      "type": "text",
      "id": "title_1",
      "label": "Title 1 (optional)",
      "default": "Coats and Jackets"
    },
    {
      "type": "header",
      "content": "Collection 2"
    },
    {
      "type": "collection",
      "id": "collection_2",
      "label": "Collection 2"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Custom image 2 (optional)"
    },
    {
      "type": "text",
      "id": "title_2",
      "label": "Title 2 (optional)",
      "default": "Tops and Shirts"
    },
    {
      "type": "header",
      "content": "Collection 3"
    },
    {
      "type": "collection",
      "id": "collection_3",
      "label": "Collection 3"
    },
    {
      "type": "image_picker",
      "id": "image_3",
      "label": "Custom image 3 (optional)"
    },
    {
      "type": "text",
      "id": "title_3",
      "label": "Title 3 (optional)",
      "default": "T-shirts"
    },
    {
      "type": "header",
      "content": "Placeholder images"
    },
    {
      "type": "image_picker",
      "id": "placeholder_image_1",
      "label": "Placeholder image 1"
    },
    {
      "type": "image_picker",
      "id": "placeholder_image_2",
      "label": "Placeholder image 2"
    },
    {
      "type": "image_picker",
      "id": "placeholder_image_3",
      "label": "Placeholder image 3"
    }
  ],
  "presets": [
    {
      "name": "Collection Row (3 columns)",
      "category": "Collections"
    }
  ]
}
{% endschema %}
