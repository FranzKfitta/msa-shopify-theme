{%- liquid
  assign product = product | default: card_product
  if product == blank
    assign product = collections.all.products.first
  endif
  
  assign first_image = product.featured_image
  assign second_image = product.images[1] | default: product.featured_image
  assign is_sold_out = false
  if product.available == false
    assign is_sold_out = true
  endif
-%}

<div class="product-card group cursor-pointer flex-shrink-0 w-full">
  <div class="product-image-container relative overflow-hidden mb-4 w-full aspect-[3/4] bg-gray-50">
    <a href="{{ product.url }}" class="block absolute inset-0 z-10">
      {%- if first_image != blank -%}
        <img
          src="{{ first_image | image_url: width: 600 }}"
          alt="{{ first_image.alt | escape | default: product.title }}"
          class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500"
          loading="lazy"
        >
        {%- if second_image != blank and second_image != first_image -%}
          <img
            src="{{ second_image | image_url: width: 600 }}"
            alt="{{ second_image.alt | escape | default: product.title }}"
            class="absolute inset-0 w-full h-full object-cover opacity-0 group-hover:opacity-100 transition-opacity duration-500"
            loading="lazy"
          >
        {%- endif -%}
      {%- else -%}
        <div class="absolute inset-0 w-full h-full flex items-center justify-center text-gray-300">
          <span class="text-xs uppercase tracking-widest">No image</span>
        </div>
      {%- endif -%}
    </a>
    
    {%- comment -%} Sold Out Badge {%- endcomment -%}
    {%- if is_sold_out -%}
      <div class="absolute top-2 right-2 px-2 py-1 text-[10px] font-medium uppercase tracking-widest text-white bg-black z-20">
        Sold Out
      </div>
    {%- endif -%}
  </div>

  <a href="{{ product.url }}" class="block">
    <div class="text-center space-y-1">
      <h3 class="font-serif text-base uppercase tracking-wide group-hover:underline decoration-1 underline-offset-4">{{ product.title }}</h3>
      <p class="text-xs text-gray-600 tracking-widest">
        {{ product.price | money }}
        {%- if product.compare_at_price > product.price -%}
          <span class="line-through text-gray-400 ml-2">{{ product.compare_at_price | money }}</span>
        {%- endif -%}
      </p>
    </div>
  </a>
</div>
