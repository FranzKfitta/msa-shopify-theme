{% schema %}
{
  "name": "Footer",
  "settings": [
    {
      "type": "text",
      "id": "brand_text",
      "label": "Brand Text",
      "default": "The Pure"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Timeless elegance and refined luxury for the modern woman."
    }
  ],
  "blocks": [
    {
      "type": "menu",
      "name": "Menu",
      "settings": [
        {
          "type": "text",
          "id": "menu_label",
          "label": "Menu Label",
          "default": "Shop",
          "info": "The title that appears above the menu links"
        },
        {
          "type": "link_list",
          "id": "menu_links",
          "label": "Menu Links",
          "info": "Select a menu to display links"
        }
      ]
    },
    {
      "type": "social",
      "name": "Social Link",
      "settings": [
        {
          "type": "select",
          "id": "social_platform",
          "label": "Social Platform",
          "options": [
            {
              "value": "instagram",
              "label": "Instagram"
            },
            {
              "value": "facebook",
              "label": "Facebook"
            },
            {
              "value": "twitter",
              "label": "Twitter / X"
            },
            {
              "value": "tiktok",
              "label": "TikTok"
            },
            {
              "value": "pinterest",
              "label": "Pinterest"
            },
            {
              "value": "youtube",
              "label": "YouTube"
            },
            {
              "value": "linkedin",
              "label": "LinkedIn"
            },
            {
              "value": "snapchat",
              "label": "Snapchat"
            },
            {
              "value": "whatsapp",
              "label": "WhatsApp"
            },
            {
              "value": "telegram",
              "label": "Telegram"
            },
            {
              "value": "discord",
              "label": "Discord"
            },
            {
              "value": "twitch",
              "label": "Twitch"
            },
            {
              "value": "vimeo",
              "label": "Vimeo"
            },
            {
              "value": "spotify",
              "label": "Spotify"
            },
            {
              "value": "apple_music",
              "label": "Apple Music"
            },
            {
              "value": "soundcloud",
              "label": "SoundCloud"
            }
          ],
          "default": "instagram",
          "info": "Select the social media platform"
        },
        {
          "type": "url",
          "id": "social_url",
          "label": "Social Media URL",
          "info": "Enter the full URL to your social media profile"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Footer",
      "blocks": [
        {
          "type": "menu",
          "settings": {
            "menu_label": "Shop"
          }
        },
        {
          "type": "menu",
          "settings": {
            "menu_label": "Customer Care"
          }
        },
        {
          "type": "social",
          "settings": {
            "social_platform": "instagram"
          }
        },
        {
          "type": "social",
          "settings": {
            "social_platform": "facebook"
          }
        }
      ]
    }
  ]
}
{% endschema %}

{%- comment -%} Calculate total columns: 1 (brand) + menu blocks count + 1 (newsletter) {%- endcomment -%}
{%- assign menu_blocks_count = 0 -%}
{%- for block in section.blocks -%}
  {%- if block.type == 'menu' -%}
    {%- assign menu_blocks_count = menu_blocks_count | plus: 1 -%}
  {%- endif -%}
{%- endfor -%}
{%- assign total_columns = menu_blocks_count | plus: 2 -%}

<footer class="bg-secondary border-t border-border">
  <div class="container mx-auto px-4 py-16">
    <div class="footer-grid" style="--footer-columns: {{ total_columns }};">
      <!-- Brand -->
      <div class="footer-brand">
        <h3 class="font-script text-3xl font-bold mb-4">{{ section.settings.brand_text | default: settings.footer_brand_text | default: 'The Pure' }}</h3>
        <p class="text-muted-foreground text-sm leading-relaxed">
          {{ section.settings.description | default: settings.footer_description | default: 'Timeless elegance and refined luxury for the modern woman.' }}
        </p>
      </div>

      <!-- Dynamic Menu Blocks -->
      {%- for block in section.blocks -%}
        {%- if block.type == 'menu' -%}
          <div class="footer-menu" {{ block.shopify_attributes }}>
            <h4 class="font-serif text-lg font-semibold mb-4">{{ block.settings.menu_label | default: 'Menu' }}</h4>
            {%- if block.settings.menu_links != blank -%}
              <ul class="space-y-2 text-sm">
                {%- for link in linklists[block.settings.menu_links].links -%}
                  <li>
                    <a href="{{ link.url }}" class="text-muted-foreground hover:text-foreground transition-colors">
                      {{ link.title }}
                    </a>
                  </li>
                {%- endfor -%}
              </ul>
            {%- else -%}
              <p class="text-muted-foreground text-sm italic">No menu selected. Please choose a menu in the theme editor.</p>
            {%- endif -%}
          </div>
        {%- endif -%}
      {%- endfor -%}

      <!-- Newsletter -->
      <div class="footer-newsletter">
        <h4 class="font-serif text-lg font-semibold mb-4">Newsletter</h4>
        <p class="text-muted-foreground text-sm mb-4">
          Subscribe to receive exclusive updates and offers.
        </p>
        <form action="{{ routes.cart_url }}" method="post" class="flex gap-2 mb-4">
          <input 
            type="email" 
            name="contact[email]"
            placeholder="Your email" 
            class="input bg-background"
            required
          />
          <button type="submit" class="btn btn-default btn-icon shrink-0">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
          </button>
        </form>
        <div class="flex gap-3">
          {%- for block in section.blocks -%}
            {%- if block.type == 'social' and block.settings.social_url != blank -%}
              <a 
                href="{{ block.settings.social_url }}" 
                class="btn btn-ghost btn-icon h-9 w-9" 
                aria-label="{{ block.settings.social_platform | capitalize }}"
                target="_blank"
                rel="noopener noreferrer"
                {{ block.shopify_attributes }}
              >
                {% render 'social-icon', platform: block.settings.social_platform, class: 'h-4 w-4', aria_label: block.settings.social_platform %}
              </a>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    </div>

    <div class="border-t border-border mt-12 pt-8 text-center">
      <p class="text-sm text-muted-foreground">
        Â© {{ 'now' | date: '%Y' }} {{ section.settings.brand_text | default: shop.name }}. All rights reserved.
      </p>
    </div>
  </div>
</footer>

<style>
  /* Footer Grid - Responsive layout */
  .footer-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 3rem;
  }

  /* Tablet: 2 columns */
  @media (min-width: 768px) {
    .footer-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  /* Desktop: Dynamic columns based on CSS variable */
  @media (min-width: 1024px) {
    .footer-grid {
      grid-template-columns: repeat(var(--footer-columns, 4), 1fr);
    }
  }

  /* Large screens: Limit max columns for better readability */
  @media (min-width: 1280px) {
    .footer-grid {
      max-width: 100%;
    }
    
    /* If more than 6 columns, wrap to multiple rows or limit */
    .footer-grid[style*="--footer-columns: 7"],
    .footer-grid[style*="--footer-columns: 8"],
    .footer-grid[style*="--footer-columns: 9"] {
      grid-template-columns: repeat(6, 1fr);
    }
  }

  /* Ensure brand and newsletter sections don't get too wide */
  .footer-brand,
  .footer-newsletter {
    min-width: 0; /* Prevent overflow */
  }
</style>
