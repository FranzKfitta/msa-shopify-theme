{% schema %}
{
  "name": "Cart",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "Show vendor"
    },
    {
      "type": "checkbox",
      "id": "show_cart_note",
      "default": true,
      "label": "Enable cart note"
    }
  ]
}
{% endschema %}

<div class="container mx-auto px-4 py-12 md:py-20">
  <div class="max-w-[1400px] mx-auto">
    <div class="flex items-baseline gap-2 mb-12">
      <h1 class="font-sans text-xl uppercase tracking-wide">CART</h1>
      <span class="text-gray-500 text-sm font-medium">({{ cart.item_count }})</span>
    </div>

    {%- if cart.item_count > 0 -%}
      <form action="{{ routes.cart_url }}" method="post" id="cart-form" class="grid grid-cols-1 lg:grid-cols-10 gap-12">
        
        <!-- Cart Items List (70%) -->
        <div class="lg:col-span-7">
          <div class="space-y-8">
            {%- for item in cart.items -%}
              <div class="flex gap-8 items-start border-b border-gray-100 pb-8 last:border-0" data-cart-item-key="{{ item.key }}">
                
                <!-- Product Image -->
                <div class="w-32 h-40 flex-shrink-0 overflow-hidden bg-gray-50">
                  {%- if item.image != blank -%}
                    <a href="{{ item.url }}" class="block w-full h-full">
                      <img src="{{ item.image | image_url: width: 400 }}" 
                           alt="{{ item.title | escape }}" 
                           class="w-full h-full object-cover"
                           loading="lazy">
                    </a>
                  {%- endif -%}
                </div>

                <!-- Product Details (Flex Row) -->
                <div class="flex-grow flex flex-col md:flex-row md:justify-between md:items-start gap-6">
                  
                  <!-- Info -->
                  <div class="w-full md:w-1/3">
                    <a href="{{ item.url }}" class="font-sans text-sm uppercase tracking-wide block mb-2">
                      {{ item.product.title }}
                    </a>
                    {%- if item.product.has_only_default_variant == false -%}
                      <p class="text-xs text-gray-500 mb-1">{{ item.variant.title }}</p>
                    {%- endif -%}
                    <p class="text-xs text-gray-500">{{ item.final_line_price | money }}</p>
                  </div>

                  <!-- Quantity & Remove -->
                  <div class="flex items-center gap-6">
                    <div class="flex items-center bg-[#F5F5F5] px-3 h-10">
                      <a href="{{ routes.cart_change_url }}?line={{ forloop.index }}&quantity={{ item.quantity | minus: 1 }}" 
                         class="w-4 flex items-center justify-center text-lg hover:text-gray-600 transition-colors"
                         aria-label="Decrease quantity">
                        -
                      </a>
                      <input type="number" 
                             name="updates[]" 
                             value="{{ item.quantity }}" 
                             min="0" 
                             id="Quantity-{{ item.index | plus: 1 }}"
                             class="w-10 text-center border-none p-0 text-sm bg-transparent focus:ring-0"
                             aria-label="Quantity">
                      <a href="{{ routes.cart_change_url }}?line={{ forloop.index }}&quantity={{ item.quantity | plus: 1 }}" 
                         class="w-4 flex items-center justify-center text-lg hover:text-gray-600 transition-colors"
                         aria-label="Increase quantity">
                        +
                      </a>
                    </div>
                    
                    <a href="{{ item.url_to_remove }}" class="text-gray-400 hover:text-black transition-colors" aria-label="Remove">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                    </a>
                  </div>

                  <!-- Total Price (Far Right) -->
                  <div class="text-right min-w-[80px]">
                    <span class="text-sm font-medium">{{ item.final_line_price | money }}</span>
                  </div>

                </div>
              </div>
            {%- endfor -%}
          </div>
        </div>

        <!-- Order Summary (30%) -->
        <div class="lg:col-span-3">
          <div class="sticky top-24">
            
            <!-- Discount Toggle -->
            <div class="border-b border-gray-200 py-4 mb-6">
              <details class="group">
                <summary class="flex justify-between items-center cursor-pointer list-none text-xs uppercase tracking-wide">
                  <span>Réduction</span>
                  <span class="text-lg leading-none group-open:rotate-45 transition-transform">+</span>
                </summary>
                <div class="mt-4 flex gap-2">
                  <input type="text" name="discount" class="w-full border border-gray-300 p-2 text-xs focus:border-black focus:ring-0" placeholder="Discount code">
                  <button type="button" class="bg-black text-white px-4 text-xs uppercase tracking-wider">Apply</button>
                </div>
              </details>
            </div>

            <!-- Total -->
            <div class="flex justify-between items-end mb-2">
              <span class="text-sm font-medium">Total estimé</span>
              <div class="text-right">
                <span class="text-xl font-medium">{{ cart.total_price | money }} {{ cart.currency.iso_code }}</span>
              </div>
            </div>
            
            <p class="text-[10px] text-gray-500 mb-8">Droits de douane et taxes inclus. L'expédition est calculée lors du paiement.</p>

            <!-- Checkout Button -->
            <button type="submit" name="checkout" class="w-full bg-black text-white h-12 text-xs uppercase tracking-widest hover:bg-gray-900 transition-colors mb-3">
              Payer
            </button>
            
            <!-- Shop Pay -->
            <button type="submit" name="checkout" class="w-full bg-[#5A31F4] text-white h-12 text-xs uppercase tracking-widest hover:bg-[#4c29d3] transition-colors mb-3">
              Shop Pay
            </button>

            <!-- PayPal -->
            <button type="submit" name="checkout" class="w-full bg-[#FFC439] text-black h-12 text-xs uppercase tracking-widest hover:bg-[#e6b133] transition-colors">
              PayPal
            </button>

          </div>
        </div>
      </form>
    {%- else -%}
      <div class="flex flex-col items-center justify-center py-20 text-center">
        <p class="text-lg font-serif mb-8">Your cart is currently empty.</p>
        <a href="{{ routes.all_products_collection_url }}" class="inline-block border border-black px-12 py-4 text-xs uppercase tracking-[0.2em] hover:bg-black hover:text-white transition-all duration-300">
          Start Shopping
        </a>
      </div>
    {%- endif -%}
  </div>
</div>
